{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/housekeeping-service/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n/**\n * PrismaClient 单例模式实现。\n * 在开发环境下，Next.js 的热重载会导致创建多个 PrismaClient 实例，\n * 从而耗尽数据库连接池。通过将实例挂载到 globalThis 上可以避免此问题。\n */\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient({\n    log: ['error'],\n  });\n};\n\ndeclare const globalThis: {\n  prismaGlobal: ReturnType<typeof prismaClientSingleton> | undefined;\n} & typeof global;\n\nconst prisma = globalThis.prismaGlobal ?? prismaClientSingleton();\n\nexport const db = prisma;\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma;"],"names":[],"mappings":";;;;;;AAAA;;AAEA;;;;CAIC,GAED,MAAM,wBAAwB;IAC5B,OAAO,IAAI,sMAAY,CAAC;QACtB,KAAK;YAAC;SAAQ;IAChB;AACF;AAMA,MAAM,SAAS,WAAW,YAAY,IAAI;AAEnC,MAAM,KAAK;uCAEH;AAEf,wCAA2C,WAAW,YAAY,GAAG"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///D:/housekeeping-service/src/features/caregivers/schema.ts"],"sourcesContent":["import { z } from 'zod';\n\n// -----------------------------------------------------------------------------\n// 1. Enum Definitions (Matching assumed Prisma Enums)\n// -----------------------------------------------------------------------------\n\nexport const GenderEnum = z.enum(['MALE', 'FEMALE']);\nexport const EducationEnum = z.enum([\n  'PRIMARY',\n  'JUNIOR_HIGH',\n  'SENIOR_HIGH',\n  'VOCATIONAL',\n  'COLLEGE',\n  'BACHELOR',\n]);\nexport const WorkExperienceLevelEnum = z.enum(['ENTRY', 'INTERMEDIATE', 'SENIOR', 'EXPERT']);\nexport const LiveInStatusEnum = z.enum(['LIVE_IN', 'LIVE_OUT', 'BOTH']);\nexport const CaregiverLevelEnum = z.enum(['TRAINEE', 'JUNIOR', 'SENIOR', 'GOLD', 'DIAMOND']);\nexport const CaregiverStatusEnum = z.enum(['PENDING', 'ACTIVE', 'INACTIVE', 'SUSPENDED', 'BLACKLISTED']);\n\n// -----------------------------------------------------------------------------\n// 2. Form Schema Definition\n// -----------------------------------------------------------------------------\n\nexport const caregiverFormSchema = z.object({\n  // --- Step 1: Basic Info ---\n  workerId: z.string().min(1, '工号不能为空'),\n  name: z.string().min(2, '姓名至少需要2个字符'),\n  phone: z\n    .string()\n    .regex(/^1[3-9]\\d{9}$/, '请输入有效的11位手机号码'),\n  idCardNumber: z\n    .string()\n    .regex(\n      /^[1-9]\\d{5}(18|19|20)\\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/,\n      '请输入有效的身份证号码'\n    ),\n  dob: z.coerce.date().optional().nullable(),\n  gender: GenderEnum.optional().nullable(),\n  nativePlace: z.string().optional(),\n  education: EducationEnum.optional().nullable(),\n  notes: z.string().optional(),\n\n  // --- Step 2: Professional Info ---\n  workExpLevel: WorkExperienceLevelEnum.optional().nullable(),\n  isLiveIn: LiveInStatusEnum.optional().nullable(), // Corresponds to LiveInStatus\n  specialties: z\n    .array(z.string())\n    .min(1, '请至少选择一项特长'),\n  cookingSkills: z.array(z.string()).default([]), // Optional in logic, but array type\n  languages: z.array(z.string()).default([]),\n\n  // --- Step 3: Files ---\n  avatarUrl: z.string().url('无效的头像链接').optional().or(z.literal('')),\n  idCardFrontUrl: z.string().url('无效的身份证正面链接').optional().or(z.literal('')),\n  idCardBackUrl: z.string().url('无效的身份证背面链接').optional().or(z.literal('')),\n});\n\n// -----------------------------------------------------------------------------\n// 3. Types\n// -----------------------------------------------------------------------------\n\nexport type CaregiverFormValues = z.infer<typeof caregiverFormSchema>;\n\n// -----------------------------------------------------------------------------\n// 4. Default Values Helper\n// -----------------------------------------------------------------------------\n\nexport const defaultCaregiverValues: Partial<CaregiverFormValues> = {\n  workerId: '',\n  name: '',\n  phone: '',\n  idCardNumber: '',\n  // dob: undefined, // Date picker usually handles undefined/null\n  // gender: 'FEMALE', // Remove default\n  nativePlace: '',\n  // education: 'JUNIOR_HIGH', // Remove default\n  // workExpLevel: 'ENTRY', // Remove default\n  // isLiveIn: 'LIVE_OUT', // Remove default\n  specialties: [],\n  cookingSkills: [],\n  languages: [],\n  avatarUrl: '',\n  idCardFrontUrl: '',\n  idCardBackUrl: '',\n  notes: '',\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAMO,MAAM,aAAa,kLAAC,CAAC,IAAI,CAAC;IAAC;IAAQ;CAAS;AAC5C,MAAM,gBAAgB,kLAAC,CAAC,IAAI,CAAC;IAClC;IACA;IACA;IACA;IACA;IACA;CACD;AACM,MAAM,0BAA0B,kLAAC,CAAC,IAAI,CAAC;IAAC;IAAS;IAAgB;IAAU;CAAS;AACpF,MAAM,mBAAmB,kLAAC,CAAC,IAAI,CAAC;IAAC;IAAW;IAAY;CAAO;AAC/D,MAAM,qBAAqB,kLAAC,CAAC,IAAI,CAAC;IAAC;IAAW;IAAU;IAAU;IAAQ;CAAU;AACpF,MAAM,sBAAsB,kLAAC,CAAC,IAAI,CAAC;IAAC;IAAW;IAAU;IAAY;IAAa;CAAc;AAMhG,MAAM,sBAAsB,kLAAC,CAAC,MAAM,CAAC;IAC1C,6BAA6B;IAC7B,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,MAAM,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,OAAO,kLAAC,CACL,MAAM,GACN,KAAK,CAAC,iBAAiB;IAC1B,cAAc,kLAAC,CACZ,MAAM,GACN,KAAK,CACJ,wFACA;IAEJ,KAAK,kLAAC,CAAC,MAAM,CAAC,IAAI,GAAG,QAAQ,GAAG,QAAQ;IACxC,QAAQ,WAAW,QAAQ,GAAG,QAAQ;IACtC,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,WAAW,cAAc,QAAQ,GAAG,QAAQ;IAC5C,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAE1B,oCAAoC;IACpC,cAAc,wBAAwB,QAAQ,GAAG,QAAQ;IACzD,UAAU,iBAAiB,QAAQ,GAAG,QAAQ;IAC9C,aAAa,kLAAC,CACX,KAAK,CAAC,kLAAC,CAAC,MAAM,IACd,GAAG,CAAC,GAAG;IACV,eAAe,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE;IAC7C,WAAW,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE;IAEzC,wBAAwB;IACxB,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,WAAW,QAAQ,GAAG,EAAE,CAAC,kLAAC,CAAC,OAAO,CAAC;IAC7D,gBAAgB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,cAAc,QAAQ,GAAG,EAAE,CAAC,kLAAC,CAAC,OAAO,CAAC;IACrE,eAAe,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,cAAc,QAAQ,GAAG,EAAE,CAAC,kLAAC,CAAC,OAAO,CAAC;AACtE;AAYO,MAAM,yBAAuD;IAClE,UAAU;IACV,MAAM;IACN,OAAO;IACP,cAAc;IACd,gEAAgE;IAChE,sCAAsC;IACtC,aAAa;IACb,8CAA8C;IAC9C,2CAA2C;IAC3C,0CAA0C;IAC1C,aAAa,EAAE;IACf,eAAe,EAAE;IACjB,WAAW,EAAE;IACb,WAAW;IACX,gBAAgB;IAChB,eAAe;IACf,OAAO;AACT"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///D:/housekeeping-service/src/features/caregivers/actions.ts"],"sourcesContent":["'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { db } from '@/lib/prisma';\nimport { caregiverFormSchema, type CaregiverFormValues } from './schema';\nimport { type ActionState } from './types';\nimport { Prisma } from '@prisma/client';\n\nexport async function createCaregiver(\n  data: CaregiverFormValues\n): Promise<ActionState> {\n  const validatedFields = caregiverFormSchema.safeParse(data);\n\n  if (!validatedFields.success) {\n    return {\n      success: false,\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: '表单验证失败，请检查输入',\n    };\n  }\n\n  const { specialties, cookingSkills, languages, ...otherData } = validatedFields.data;\n\n  try {\n    await db.caregiver.create({\n      data: {\n        ...otherData,\n        specialties: JSON.stringify(specialties),\n        cookingSkills: JSON.stringify(cookingSkills),\n        languages: JSON.stringify(languages),\n        // 默认状态，如果在 Schema 中没有定义，可以在这里指定\n        status: 'PENDING', \n        level: 'TRAINEE',\n      },\n    });\n\n    revalidatePath('/caregivers');\n\n    return {\n      success: true,\n      message: '护理员创建成功',\n    };\n  } catch (error) {\n    console.error('Failed to create caregiver:', error);\n\n    // 处理 Prisma 唯一约束冲突 (例如 workerId 重复)\n    if (error instanceof Prisma.PrismaClientKnownRequestError) {\n      if (error.code === 'P2002') {\n        return {\n          success: false,\n          message: '该手机号或身份证号已存在',\n        };\n      }\n    }\n\n    return {\n      success: false,\n      message: '创建护理员失败，请稍后重试',\n    };\n  }\n}\n\nexport async function updateCaregiver(\n  id: string,\n  data: CaregiverFormValues\n): Promise<ActionState> {\n  const validatedFields = caregiverFormSchema.safeParse(data);\n\n  if (!validatedFields.success) {\n    return {\n      success: false,\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: '表单验证失败，请检查输入',\n    };\n  }\n\n  const { specialties, cookingSkills, languages, ...otherData } = validatedFields.data;\n\n  try {\n    await db.caregiver.update({\n      where: { idString: id },\n      data: {\n        ...otherData,\n        specialties: JSON.stringify(specialties),\n        cookingSkills: JSON.stringify(cookingSkills),\n        languages: JSON.stringify(languages),\n      },\n    });\n\n    revalidatePath('/caregivers');\n    revalidatePath(`/caregivers/${id}`);\n\n    return {\n      success: true,\n      message: '护理员信息更新成功',\n    };\n  } catch (error) {\n    console.error('Failed to update caregiver:', error);\n\n    if (error instanceof Prisma.PrismaClientKnownRequestError) {\n      if (error.code === 'P2002') {\n        return {\n          success: false,\n          message: '该手机号或身份证号已存在',\n        };\n      }\n    }\n\n    return {\n      success: false,\n      message: '更新失败，请稍后重试',\n    };\n  }\n}\n\nexport async function getCaregivers() {\n  try {\n    const caregivers = await db.caregiver.findMany({\n      orderBy: {\n        createdAt: 'desc',\n      },\n    });\n\n    return caregivers.map((caregiver) => {\n      // Helper to safely parse JSON\n      const safeParse = (jsonString: string | null) => {\n        if (!jsonString) return [];\n        try {\n          return JSON.parse(jsonString) as string[];\n        } catch (e) {\n          console.error(`Failed to parse JSON for caregiver ${caregiver.idString}:`, e);\n          return [];\n        }\n      };\n\n      return {\n        ...caregiver,\n        specialties: safeParse(caregiver.specialties),\n        cookingSkills: safeParse(caregiver.cookingSkills),\n        languages: safeParse(caregiver.languages),\n      };\n    });\n  } catch (error) {\n    console.error('Failed to fetch caregivers:', error);\n    return [];\n  }\n}\n\nexport async function getCaregiver(id: string) {\n  try {\n    const caregiver = await db.caregiver.findUnique({\n      where: {\n        idString: id,\n      },\n    });\n\n    if (!caregiver) return null;\n\n    // Helper to safely parse JSON\n    const safeParse = (jsonString: string | null) => {\n      if (!jsonString) return [];\n      try {\n        return JSON.parse(jsonString) as string[];\n      } catch (e) {\n        console.error(`Failed to parse JSON for caregiver ${caregiver.idString}:`, e);\n        return [];\n      }\n    };\n\n    return {\n      ...caregiver,\n      specialties: safeParse(caregiver.specialties),\n      cookingSkills: safeParse(caregiver.cookingSkills),\n      languages: safeParse(caregiver.languages),\n    };\n  } catch (error) {\n    console.error('Failed to fetch caregiver:', error);\n    return null;\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 316, "column": 0}, "map": {"version":3,"sources":["file:///D:/housekeeping-service/.next-internal/server/app/%28dashboard%29/caregivers/%5Bid%5D/edit/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getCaregivers as '00e0042958643f2757eadb780288700c8d9574de6f'} from 'ACTIONS_MODULE0'\nexport {getCaregiver as '404c24dbfb8a4607adee53ef66000fa159d3ed73c3'} from 'ACTIONS_MODULE0'\nexport {createCaregiver as '40799a5a3ff51764feef7f79b0f477de03b7dc9688'} from 'ACTIONS_MODULE0'\nexport {updateCaregiver as '60f2087def6e304318ecca0e214f4b7115cfb60c28'} from 'ACTIONS_MODULE0'\nexport {createCaregiver as '40799a5a3ff51764feef7f79b0f477de03b7dc9688'} from 'ACTIONS_MODULE0'\nexport {updateCaregiver as '60f2087def6e304318ecca0e214f4b7115cfb60c28'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}